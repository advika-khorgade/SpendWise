<div class="expenses-container">
  <div class="header-section">
    <h1 class="page-title">Expenses</h1>
    <p class="page-subtitle">Manage your daily expenses and track your spending</p>
  </div>

  <!-- Loading Bar -->
  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <!-- success/Error Messages -->
  <div *ngIf="successMessage" class="success-message-box">
    <mat-icon>check_circle</mat-icon>
    {{ successMessage }}
  </div>

  <div *ngIf="errorMessage" class="error-message-box">
    <mat-icon>error</mat-icon>
    {{ errorMessage }}
  </div>

  <mat-tab-group>
    <mat-tab label="Expenses List">
      <!-- Add Expense Form -->
      <mat-card class="form-card">
        <mat-card-header>
          <h2>Add New Expense</h2>
        </mat-card-header>
        <mat-card-content>
          <form (ngSubmit)="addExpense()" class="expense-form">
            <mat-form-field appearance="outline">
              <mat-label>Title</mat-label>
              <input matInput [(ngModel)]="title" name="title" placeholder="Expense title" />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Amount</mat-label>
              <input
                matInput
                type="number"
                [(ngModel)]="amount"
                name="amount"
                placeholder="0.00"
                step="0.01"
              />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Category</mat-label>
              <select matNativeControl [(ngModel)]="category" name="category">
                <option value="">Select Category</option>
                <option value="food">Food</option>
                <option value="transport">Transport</option>
                <option value="entertainment">Entertainment</option>
                <option value="shopping">Shopping</option>
                <option value="utilities">Utilities</option>
                <option value="health">Health</option>
                <option value="education">Education</option>
                <option value="other">Other</option>
              </select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Date</mat-label>
              <input matInput [matDatepicker]="picker" [(ngModel)]="date" name="date" />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>

            <button mat-raised-button color="primary" type="submit" class="add-button">
              <mat-icon>add</mat-icon>
              Add Expense
            </button>
          </form>
        </mat-card-content>
      </mat-card>

      <!-- Filter Section -->
      <mat-card class="filter-card">
        <mat-card-header>
          <h2>Filter Expenses by Date</h2>
        </mat-card-header>
        <mat-card-content>
          <div class="filter-form">
            <mat-form-field appearance="outline">
              <mat-label>Start Date</mat-label>
              <input
                matInput
                [matDatepicker]="startPicker"
                [(ngModel)]="startDate"
                name="startDate"
              />
              <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
              <mat-datepicker #startPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>End Date</mat-label>
              <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDate" name="endDate" />
              <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
              <mat-datepicker #endPicker></mat-datepicker>
            </mat-form-field>

            <button mat-raised-button color="accent" (click)="filterExpenses()" class="filter-button">
              <mat-icon>filter_list</mat-icon>
              Filter
            </button>

            <button
              *ngIf="filterActive"
              mat-stroked-button
              (click)="resetFilter()"
              class="reset-button"
            >
              <mat-icon>clear</mat-icon>
              Clear Filter
            </button>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Expenses Table -->
      <mat-card class="table-card">
        <mat-card-header>
          <h2>Your Expenses</h2>
          <span class="expense-count">Total: {{ expenses.length }} expenses</span>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="expenses.length === 0" class="empty-state">
            <mat-icon>receipt_long</mat-icon>
            <p>No expenses found. Start adding your expenses!</p>
          </div>

          <div *ngIf="expenses.length > 0" class="table-wrapper">
            <table mat-table [dataSource]="expenses" class="expenses-table">
              <!-- Title Column -->
              <ng-container matColumnDef="title">
                <th mat-header-cell *matHeaderCellDef>Title</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.title }}
                </td>
              </ng-container>

              <!-- Amount Column -->
              <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef>Amount</th>
                <td mat-cell *matCellDef="let element" class="amount-cell">
                  {{ element.amount | currency }}
                </td>
              </ng-container>

              <!-- Category Column -->
              <ng-container matColumnDef="category">
                <th mat-header-cell *matHeaderCellDef>Category</th>
                <td mat-cell *matCellDef="let element">
                  <span
                    class="category-badge"
                    [style.background-color]="getCategoryColor(element.category)"
                  >
                    {{ element.category | titlecase }}
                  </span>
                </td>
              </ng-container>

              <!-- Date Column -->
              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Date</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.date | date: 'MMM dd, yyyy' }}
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let element">
                  <button mat-icon-button color="warn" (click)="deleteExpense(element.id)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns" class="table-row"></tr>
            </table>
          </div>
        </mat-card-content>
      </mat-card>
    </mat-tab>

    <mat-tab label="Category Chart">
      <mat-card class="chart-card">
        <mat-card-content>
          <h3>Category Breakdown</h3>
          <canvas baseChart
                  [data]="pieChartData"
                  [options]="pieChartOptions"
                  [type]="pieChartType">
          </canvas>
        </mat-card-content>
      </mat-card>
      <mat-card class="chart-card">
        <mat-card-content>
          <h3>Monthly Trends</h3>
          <canvas baseChart
                  [data]="lineChartData"
                  [options]="lineChartOptions"
                  [type]="lineChartType">
          </canvas>
        </mat-card-content>
      </mat-card>
    </mat-tab>
  </mat-tab-group>
</div>

